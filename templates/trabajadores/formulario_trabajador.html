{% extends "base.html" %}

{% block title %}
    {{ form.instance.pk|yesno:"Editar Trabajador,Crear Trabajador" }}
{% endblock %}

{% block content %}

<div class="space-y-5">

    <!-- Header Card -->
    <div class="bg-white dark:bg-dark-900 rounded-xl shadow-sm border border-gray-200 dark:border-dark-800 p-6">
        <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-emerald-100 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-400">
                <i class="fas fa-{{ form.instance.pk|yesno:'user-edit,user-plus' }} text-lg"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                    {{ form.instance.pk|yesno:"Editar Trabajador,Crear Trabajador" }}
                </h1>
                <p class="text-sm text-gray-600 dark:text-dark-300">
                    {{ form.instance.pk|yesno:"Modifica los datos del trabajador,Completa el formulario para agregar un nuevo trabajador" }}
                </p>
            </div>
        </div>
    </div>

    <form method="post" class="space-y-5">
            {% csrf_token %}

            <!-- Personal Information Card -->
            <div class="bg-white dark:bg-dark-900 rounded-xl shadow-sm border border-gray-200 dark:border-dark-800 p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-5 flex items-center gap-2">
                    <i class="fas fa-user text-emerald-600 dark:text-emerald-400"></i>
                    Información Personal
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                    <!-- Número de Empleado -->
                    <div>
                        <label for="{{ form.numero_empleado.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.numero_empleado.label }}
                            {% if form.numero_empleado.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <input type="{{ form.numero_empleado.field.widget.input_type }}"
                               name="{{ form.numero_empleado.name }}"
                               id="{{ form.numero_empleado.id_for_label }}"
                               {% if form.numero_empleado.value %}value="{{ form.numero_empleado.value }}"{% endif %}
                               {% if form.numero_empleado.field.required %}required{% endif %}
                               class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-dark-500">
                        {% if form.numero_empleado.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.numero_empleado.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Nombre -->
                    <div>
                        <label for="{{ form.nombre.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.nombre.label }}
                            {% if form.nombre.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <input type="text"
                               name="{{ form.nombre.name }}"
                               id="{{ form.nombre.id_for_label }}"
                               {% if form.nombre.value %}value="{{ form.nombre.value }}"{% endif %}
                               {% if form.nombre.field.required %}required{% endif %}
                               class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-dark-500">
                        {% if form.nombre.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.nombre.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Apellido Paterno -->
                    <div>
                        <label for="{{ form.apellido_paterno.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.apellido_paterno.label }}
                            {% if form.apellido_paterno.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <input type="text"
                               name="{{ form.apellido_paterno.name }}"
                               id="{{ form.apellido_paterno.id_for_label }}"
                               {% if form.apellido_paterno.value %}value="{{ form.apellido_paterno.value }}"{% endif %}
                               {% if form.apellido_paterno.field.required %}required{% endif %}
                               class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-dark-500">
                        {% if form.apellido_paterno.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.apellido_paterno.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Apellido Materno -->
                    <div>
                        <label for="{{ form.apellido_materno.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.apellido_materno.label }}
                            {% if form.apellido_materno.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <input type="text"
                               name="{{ form.apellido_materno.name }}"
                               id="{{ form.apellido_materno.id_for_label }}"
                               {% if form.apellido_materno.value %}value="{{ form.apellido_materno.value }}"{% endif %}
                               {% if form.apellido_materno.field.required %}required{% endif %}
                               class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-dark-500">
                        {% if form.apellido_materno.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.apellido_materno.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- RFC -->
                    <div>
                        <label for="{{ form.rfc.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.rfc.label }}
                            {% if form.rfc.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <input type="text"
                               name="{{ form.rfc.name }}"
                               id="{{ form.rfc.id_for_label }}"
                               {% if form.rfc.value %}value="{{ form.rfc.value }}"{% endif %}
                               {% if form.rfc.field.required %}required{% endif %}
                               placeholder="Ej: ABCD123456XY1"
                               class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-dark-500 uppercase">
                        {% if form.rfc.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.rfc.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- CURP -->
                    <div>
                        <label for="{{ form.curp.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.curp.label }}
                            {% if form.curp.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <input type="text"
                               name="{{ form.curp.name }}"
                               id="{{ form.curp.id_for_label }}"
                               {% if form.curp.value %}value="{{ form.curp.value }}"{% endif %}
                               {% if form.curp.field.required %}required{% endif %}
                               placeholder="Ej: ABCD123456HDFXYZ01"
                               class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-dark-500 uppercase">
                        {% if form.curp.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.curp.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Work Information Card -->
            <div class="bg-white dark:bg-dark-900 rounded-xl shadow-sm border border-gray-200 dark:border-dark-800 p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-5 flex items-center gap-2">
                    <i class="fas fa-briefcase text-emerald-600 dark:text-emerald-400"></i>
                    Información Laboral
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                    <!-- Unidad Administrativa -->
                    <div>
                        <label for="{{ form.id_unidad.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.id_unidad.label }}
                            {% if form.id_unidad.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        {% if es_jefe %}
                        <!-- Jefe: Campo de solo lectura -->
                        <div class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg bg-gray-100 dark:bg-dark-800/50 text-gray-700 dark:text-dark-300 flex items-center gap-2">
                            <i class="fas fa-building text-emerald-600 dark:text-emerald-400"></i>
                            <span class="font-medium">{{ form.id_unidad.field.queryset.first }}</span>
                        </div>
                        <input type="hidden" name="{{ form.id_unidad.name }}" value="{{ form.id_unidad.field.queryset.first.pk }}">
                        <p class="mt-1.5 text-xs text-gray-500 dark:text-dark-400">
                            <i class="fas fa-info-circle mr-1"></i>Los trabajadores se agregan automáticamente a tu unidad
                        </p>
                        {% else %}
                        <!-- Admin: Select normal -->
                        <select name="{{ form.id_unidad.name }}"
                                id="{{ form.id_unidad.id_for_label }}"
                                {% if form.id_unidad.field.required %}required{% endif %}
                                class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white">
                            <option value="">-- Seleccionar --</option>
                            {% for choice in form.id_unidad.field.queryset %}
                            <option value="{{ choice.pk }}" {% if form.id_unidad.value == choice.pk %}selected{% endif %}>{{ choice }}</option>
                            {% endfor %}
                        </select>
                        {% endif %}
                        {% if form.id_unidad.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.id_unidad.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Puesto -->
                    <div>
                        <label for="{{ form.id_puesto.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.id_puesto.label }}
                            {% if form.id_puesto.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <select name="{{ form.id_puesto.name }}"
                                id="{{ form.id_puesto.id_for_label }}"
                                {% if form.id_puesto.field.required %}required{% endif %}
                                class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white">
                            <option value="">-- Seleccionar --</option>
                            {% for choice in form.id_puesto.field.queryset %}
                            <option value="{{ choice.pk }}" {% if form.id_puesto.value == choice.pk %}selected{% endif %}>{{ choice }}</option>
                            {% endfor %}
                        </select>
                        {% if form.id_puesto.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.id_puesto.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Tipo de Nombramiento -->
                    <div>
                        <label for="{{ form.id_tipo_nombramiento.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">
                            {{ form.id_tipo_nombramiento.label }}
                            {% if form.id_tipo_nombramiento.field.required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        <select name="{{ form.id_tipo_nombramiento.name }}"
                                id="{{ form.id_tipo_nombramiento.id_for_label }}"
                                {% if form.id_tipo_nombramiento.field.required %}required{% endif %}
                                class="w-full px-4 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent bg-white dark:bg-dark-800 text-gray-900 dark:text-white">
                            <option value="">-- Seleccionar --</option>
                            {% for choice in form.id_tipo_nombramiento.field.queryset %}
                            <option value="{{ choice.pk }}" {% if form.id_tipo_nombramiento.value == choice.pk %}selected{% endif %}>{{ choice }}</option>
                            {% endfor %}
                        </select>
                        {% if form.id_tipo_nombramiento.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.id_tipo_nombramiento.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <!-- Estado Activo (Switch para edición / Hidden para creación) -->
                    {% if form.instance.pk %}
                    <div class="pt-8">
                        <label class="block text-sm font-medium text-gray-700 dark:text-dark-300 mb-3">
                            Estado del Trabajador
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" 
                                   name="{{ form.activo.name }}"
                                   id="{{ form.activo.id_for_label }}"
                                   {% if form.activo.value %}checked{% endif %}
                                   class="sr-only peer"
                                   onchange="updateSwitchLabel(this)">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-emerald-300 dark:peer-focus:ring-emerald-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-emerald-600"></div>
                            <span class="ms-3 text-sm font-medium text-gray-700 dark:text-dark-300" id="switch-label">
                                {% if form.activo.value %}
                                    Activo
                                {% else %}
                                    Inactivo
                                {% endif %}
                            </span>
                        </label>
                        {% if form.activo.errors %}
                        <p class="mt-1.5 text-sm text-red-600 dark:text-red-400">{{ form.activo.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% else %}
                    <!-- Al crear, siempre activo por defecto -->
                    <input type="hidden" name="{{ form.activo.name }}" value="on">
                    {% endif %}
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center gap-3">
                <button type="submit"
                        class="inline-flex items-center gap-2 px-6 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors text-sm font-medium shadow-sm">
                    <i class="fas fa-save"></i>
                    <span>Guardar Trabajador</span>
                </button>

                <a href="{% url 'trabajadores:index' %}"
                   class="inline-flex items-center gap-2 px-6 py-2.5 bg-gray-500 hover:bg-gray-600 dark:bg-dark-700 dark:hover:bg-dark-600 text-white rounded-lg transition-colors text-sm font-medium shadow-sm">
                    <i class="fas fa-times"></i>
                    <span>Cancelar</span>
                </a>
            </div>

    </form>

</div>

<script>
// Actualizar el label del switch cuando cambia
function updateSwitchLabel(checkbox) {
    const label = document.getElementById('switch-label');
    if (checkbox.checked) {
        label.textContent = 'Activo';
    } else {
        label.textContent = 'Inactivo';
    }
}
</script>

{% endblock %}
