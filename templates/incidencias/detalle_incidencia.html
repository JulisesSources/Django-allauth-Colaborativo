<!-- templates/incidencias/detalle_incidencia.html -->
{% extends 'base.html' %}

{% block title %}Detalle de Incidencia - SCA-B123{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Botón Volver -->
    <div>
        <a href="{% url 'incidencias:lista_incidencias' %}" 
           class="inline-flex items-center text-blue-600 hover:text-blue-800">
            <i class="fas fa-arrow-left mr-2"></i>
            Volver a la lista
        </a>
    </div>
    
    <!-- Header -->
    <div class="bg-white shadow-xl rounded-lg overflow-hidden">
        <div class="bg-gradient-to-r from-green-600 to-green-800 px-6 py-8">
            <div class="flex items-center justify-between">
                <div class="text-white">
                    <h1 class="text-3xl font-bold">Detalle de Incidencia</h1>
                    <p class="text-green-200 mt-1">ID: {{ incidencia.id_incidencia }}</p>
                </div>
                <div class="text-right">
                    {% if incidencia.estado == 'pendiente' %}
                        <span class="px-4 py-2 bg-yellow-500 text-white rounded-full text-sm font-semibold">
                            <i class="fas fa-clock mr-1"></i> Pendiente
                        </span>
                    {% elif incidencia.estado == 'autorizada' %}
                        <span class="px-4 py-2 bg-green-500 text-white rounded-full text-sm font-semibold">
                            <i class="fas fa-check-circle mr-1"></i> Autorizada
                        </span>
                    {% else %}
                        <span class="px-4 py-2 bg-red-500 text-white rounded-full text-sm font-semibold">
                            <i class="fas fa-times-circle mr-1"></i> Rechazada
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Información del Trabajador -->
        <div class="p-6 border-b">
            <h2 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-user text-blue-500 mr-2"></i>
                Información del Trabajador
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Nombre Completo</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.id_trabajador.nombre_completo }}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Número de Empleado</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.id_trabajador.numero_empleado }}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Unidad Administrativa</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.id_trabajador.id_unidad.nombre }}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Puesto</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.id_trabajador.id_puesto.nombre_puesto }}</p>
                </div>
            </div>
        </div>
        
        <!-- Detalles de la Incidencia -->
        <div class="p-6 border-b">
            <h2 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-calendar-alt text-green-500 mr-2"></i>
                Detalles de la Incidencia
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Tipo de Incidencia</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.id_tipo_incidencia.descripcion }}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Duración</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.duracion_dias }} día(s)</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Fecha de Inicio</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.fecha_inicio|date:"d/m/Y" }}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Fecha de Fin</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.fecha_fin|date:"d/m/Y" }}</p>
                </div>
            </div>
            
            {% if incidencia.observaciones %}
            <div class="mt-4 bg-gray-50 p-4 rounded-lg">
                <p class="text-sm text-gray-500 mb-1">Observaciones</p>
                <p class="text-gray-900">{{ incidencia.observaciones }}</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Información de Autorización -->
        {% if incidencia.autorizada_por %}
        <div class="p-6 border-b {% if incidencia.estado == 'autorizada' %}bg-green-50{% else %}bg-red-50{% endif %}">
            <h2 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-user-check {% if incidencia.estado == 'autorizada' %}text-green-500{% else %}text-red-500{% endif %} mr-2"></i>
                Información de {{ incidencia.get_estado_display }}
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">{{ incidencia.get_estado_display }} por</p>
                    <p class="font-semibold text-gray-900">
                        {{ incidencia.autorizada_por.get_full_name|default:incidencia.autorizada_por.email }}
                    </p>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Fecha de {{ incidencia.get_estado_display }}</p>
                    <p class="font-semibold text-gray-900">{{ incidencia.fecha_autorizacion|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
            
            {% if incidencia.comentario_autorizacion %}
            <div class="mt-4 bg-white p-4 rounded-lg">
                <p class="text-sm text-gray-500 mb-1">Comentario</p>
                <p class="text-gray-900">{{ incidencia.comentario_autorizacion }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Auditoría -->
        <div class="p-6 bg-gray-50">
            <h2 class="text-xl font-bold text-gray-900 mb-4">
                <i class="fas fa-history text-gray-500 mr-2"></i>
                Auditoría
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Creado por</p>
                    <p class="font-semibold text-gray-900">
                        {{ incidencia.created_by.get_full_name|default:incidencia.created_by.email }}
                    </p>
                    <p class="text-xs text-gray-500">{{ incidencia.created_at|date:"d/m/Y H:i" }}</p>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">Última actualización</p>
                    <p class="font-semibold text-gray-900">
                        {{ incidencia.updated_by.get_full_name|default:incidencia.updated_by.email }}
                    </p>
                    <p class="text-xs text-gray-500">{{ incidencia.updated_at|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
        
        <!-- Acciones -->
        <div class="p-6 bg-gray-100">
            <div class="flex flex-wrap gap-3">
                {% if puede_editar %}
                <a href="{% url 'incidencias:editar_incidencia' incidencia.pk %}" 
                   class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    <i class="fas fa-edit mr-2"></i>
                    Editar
                </a>
                {% endif %}
                
                {% if puede_autorizar %}
                <a href="{% url 'incidencias:autorizar_incidencia' incidencia.pk %}" 
                   class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                    <i class="fas fa-user-check mr-2"></i>
                    Autorizar/Rechazar
                </a>
                {% endif %}
                
                {% if user.perfil.es_admin or incidencia.created_by == user and incidencia.estado == 'pendiente' %}
                <a href="{% url 'incidencias:eliminar_incidencia' incidencia.pk %}" 
                   class="inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    <i class="fas fa-trash mr-2"></i>
                    Eliminar
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}